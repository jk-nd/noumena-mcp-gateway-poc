services:
  gateway:
    build:
      context: ..
      dockerfile: deployments/docker/Dockerfile.gateway
    ports:
    - 8080:8080
    environment:
    - NPL_URL=http://npl-engine:8080
    - OIDC_ISSUER=http://keycloak:8080/realms/noumena
    - CALLBACK_URL=http://gateway:8080/callback
    - EXECUTOR_URL=http://executor:8081
    - DEV_MODE=true
    depends_on:
    - keycloak
    - executor
    networks:
    - mcp-network
  executor:
    build:
      context: ..
      dockerfile: deployments/docker/Dockerfile.executor
    environment:
    - VAULT_ADDR=http://vault:8200
    - VAULT_TOKEN=dev-token
    - DEV_MODE=true
    depends_on:
    - vault
    networks:
    - mcp-network
  mock-mcp:
    build:
      context: ../mock-mcp
      dockerfile: Dockerfile
    networks:
    - mcp-network
  google-mcp:
    build:
      context: ../mock-mcp
      dockerfile: Dockerfile
    networks:
    - mcp-network
  slack-mcp:
    build:
      context: ../mock-mcp
      dockerfile: Dockerfile
    networks:
    - mcp-network
  vault:
    image: hashicorp/vault:latest
    ports:
    - 8200:8200
    environment:
    - VAULT_DEV_ROOT_TOKEN_ID=dev-token
    - VAULT_DEV_LISTEN_ADDRESS=0.0.0.0:8200
    cap_add:
    - IPC_LOCK
    networks:
    - mcp-network
  keycloak:
    image: quay.io/keycloak/keycloak:latest
    ports:
    - 8083:8080
    environment:
    - KEYCLOAK_ADMIN=admin
    - KEYCLOAK_ADMIN_PASSWORD=admin
    command: start-dev
    networks:
    - mcp-network
  weather-api-mcp:
    build:
      context: ../mock-mcp
      dockerfile: Dockerfile
    networks:
    - mcp-network
networks:
  mcp-network:
    driver: bridge
