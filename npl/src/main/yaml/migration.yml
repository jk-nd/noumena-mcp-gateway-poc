$schema: https://documentation.noumenadigital.com/schemas/migration-schema-v2.yml

changesets:
  - name: mcp-1.0
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml

  # V2: Added per-service ToolPolicy, transparent proxy architecture
  - name: mcp-2.0-tool-policy
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml

  # V3: Added per-user UserRegistry and UserToolAccess protocols
  - name: mcp-3.0-user-access
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml

  # V4: Allow gateway to read user access lists; remove legacy agent role
  - name: mcp-4.0-gateway-access
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml

  # V5: Allow gateway to read ServiceRegistry (enabled services visibility)
  - name: mcp-5.0-registry-gateway-access
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml

  # V6: Replace 4 protocols with unified PolicyStore singleton + contextual routing
  - name: mcp-6.0-policy-store
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml

  # V7: TUI PolicyStore integration — add setServiceMetadata, removeService, expand getPolicyData perms
  - name: mcp-7.0-tui-policy-store
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml

  # V8: Scoped approvals — approvers List<Text> on PendingApproval, approverIdentity on approve/deny
  - name: mcp-8.0-scoped-approvals
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml

  # V9: Store-and-forward — requestPayload, execution tracking on PendingApproval
  - name: mcp-9.0-store-and-forward
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml

  # V10: ApprovalPolicy party mappings in rules.yml (pAdmin, pGateway, pApprover)
  - name: mcp-10.0-approval-policy-rules
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml

  # V11: RateLimitPolicy — automated rate limiting contextual routing protocol
  - name: mcp-11.0-rate-limit-policy
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml

  # V12: Layer 2 protocols — RouteGroup composition, ConstraintPolicy,
  #      PreconditionPolicy, FlowPolicy, IdentityPolicy, package rename
  - name: mcp-12.0-layer2-protocols
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml

  # V13: v4 governance — GatewayStore + ServiceGovernance (three-layer model)
  - name: mcp-13.0-v4-governance
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml

  # V14: ServiceGovernance full protocol — evaluate, approve, deny, getPendingRequests
  - name: mcp-14.0-governance-full
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml

  # V15: Make serviceName non-private for bundle server discovery
  - name: mcp-15.0-governance-visible-name
    changes:
      - migrate:
          sources:
            - ../npl-1.0
          rules: rules.yml
