# Party Automation Rules for MCP Gateway
#
# Maps JWT claims to NPL protocol parties.
# Party names use 'p' prefix to distinguish from JWT claim roles.
#
# Hierarchy:
# - pAdmin: Organization administrators (full control)
# - pAgent: AI agents / Gateway (tool invocation, policy checks)
#
# Note: Gateway uses built-in NPL 'observers' mechanism for read access.
# Admin adds Gateway as observer via addObserver permission.

# ============================================================================
# REGISTRY PACKAGE - Service Management
# ============================================================================

registry.ServiceRegistry:
  # Admin has full control
  pAdmin:
    set:
      claims:
        role:
          - admin

# ============================================================================
# SERVICES PACKAGE - Tool Governance
# ============================================================================

# Per-service ToolPolicy (V2 architecture)
services.ToolPolicy:
  # Admin creates instances, enables/disables tools
  pAdmin:
    set:
      claims:
        role:
          - admin
  # Agent checks access before forwarding to upstream
  pAgent:
    set:
      claims:
        role:
          - agent
          - admin  # Admin can also act as agent

# ============================================================================
# USERS PACKAGE - Per-user Access Control (V3)
# ============================================================================

# UserRegistry — master list of registered users
users.UserRegistry:
  pAdmin:
    set:
      claims:
        role:
          - admin

# UserToolAccess — per-user/agent tool access control
users.UserToolAccess:
  # Admin creates instances and grants/revokes tools
  pAdmin:
    set:
      claims:
        role:
          - admin
  # The user this protocol controls (all authenticated users can be pUser)
  pUser:
    set:
      claims:
        role:
          - user
          - admin  # Admin can also act as user for management
  # Gateway checks access before routing tool calls
  pGateway:
    set:
      claims:
        role:
          - agent
          - admin  # Admin can also act as gateway for testing
