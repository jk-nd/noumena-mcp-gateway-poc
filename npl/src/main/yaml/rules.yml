# Party Automation Rules for MCP Gateway
#
# Maps JWT claims to NPL protocol parties.
# Party names use 'p' prefix to distinguish from JWT claim roles.
#
# Hierarchy:
# - pAdmin: Organization administrators (policy management)
# - pGateway: Gateway system service (runtime policy enforcement)
#
# Note: Tool users (humans and AI) are NOT parties. They're governed by
# UserToolAccess protocol instances identified by userId parameter.

# ============================================================================
# REGISTRY PACKAGE - Service Management
# ============================================================================

registry.ServiceRegistry:
  # Admin has full control
  pAdmin:
    set:
      claims:
        role:
          - admin

# ============================================================================
# SERVICES PACKAGE - Tool Governance
# ============================================================================

# Per-service ToolPolicy (service-level governance)
services.ToolPolicy:
  # Admin creates instances, enables/disables tools
  pAdmin:
    set:
      claims:
        role:
          - admin
  # Gateway system service checks access at runtime
  pGateway:
    set:
      claims:
        role:
          - gateway
          - admin  # Admin can also act as gateway for testing

# ============================================================================
# USERS PACKAGE - Per-user Access Control (V3)
# ============================================================================

# UserRegistry — master list of registered users
users.UserRegistry:
  pAdmin:
    set:
      claims:
        role:
          - admin

# UserToolAccess — per-tool-user access control (user-level governance)
# Note: Tool users (humans/AI) are NOT parties - they're identified by userId parameter
users.UserToolAccess:
  # Admin creates instances and grants/revokes tools via TUI/API
  pAdmin:
    set:
      claims:
        role:
          - admin
  # Gateway system service enforces access at runtime
  pGateway:
    set:
      claims:
        role:
          - gateway
          - admin  # Admin can also act as gateway for testing
